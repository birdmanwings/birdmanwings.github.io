<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="风控的本质是剔除坏人，保留好人。  在客户端风控对抗中，作为防守方需要在端上采集各种风险因子，环境因素上报服务端进行上报分析用于黑灰产对抗。但是在通过系统 API 进行采集信息时，可能被攻击方进行 Hook 拦截，修改了真实返回值。我们当然可以做 Hook 检测来进行判断，但是攻击方同样也可以反反 Hook，这样子无休止的循环对抗。那么，我们是否可以在关键节点来进行布局对抗呢？下文中，我们将对">
<meta property="og:type" content="article">
<meta property="og:title" content="浅谈 Android 风控边界 - Binder">
<meta property="og:url" content="http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/index.html">
<meta property="og:site_name" content="BDWMS">
<meta property="og:description" content="风控的本质是剔除坏人，保留好人。  在客户端风控对抗中，作为防守方需要在端上采集各种风险因子，环境因素上报服务端进行上报分析用于黑灰产对抗。但是在通过系统 API 进行采集信息时，可能被攻击方进行 Hook 拦截，修改了真实返回值。我们当然可以做 Hook 检测来进行判断，但是攻击方同样也可以反反 Hook，这样子无休止的循环对抗。那么，我们是否可以在关键节点来进行布局对抗呢？下文中，我们将对">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://image.bdwms.com/v2-38e2ea1d22660b237e17d2a7f298f3d6_720w.png">
<meta property="og:image" content="https://image.bdwms.com/v2-aab2affe42958a659ea8a517ffaff5a0_720w-20230910115914620.png">
<meta property="og:image" content="https://image.bdwms.com/2052730-20220223095923841-776621370.png">
<meta property="og:image" content="https://image.bdwms.com/2052730-20220223103718987-1378429682.png">
<meta property="og:image" content="https://image.bdwms.com/v2-cbd7d2befbed12d4c8896f236df96dbf_720w.png">
<meta property="og:image" content="https://image.bdwms.com/v2-729b3444cd784d882215a24067893d0e_720w.png">
<meta property="og:image" content="https://image.bdwms.com/v2-67854cdf14d07a6a4acf9d675354e1ff_720w.png">
<meta property="og:image" content="https://image.bdwms.com/v2-13361906ecda16e36a3b9cbe3d38cbc1_720w.png">
<meta property="og:image" content="https://image.bdwms.com/f65296974043e954ef789174db1c50a0.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907132054969.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907132117336.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907132145130.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907132446172.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907132625972.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907132854924.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907132945227.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907133335674.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907133539723.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907134002638.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907134727041.png">
<meta property="og:image" content="https://image.bdwms.com/image-20230907134845595.png">
<meta property="og:image" content="https://image.bdwms.com/wifi-arch.png">
<meta property="article:published_time" content="2023-09-09T03:45:33.000Z">
<meta property="article:modified_time" content="2023-09-24T13:20:09.142Z">
<meta property="article:author" content="bdwms">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.bdwms.com/v2-38e2ea1d22660b237e17d2a7f298f3d6_720w.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>浅谈 Android 风控边界 - Binder</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-188330730-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-188330730-1');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/smart-contract-security-ethernaut-part-two/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&text=浅谈 Android 风控边界 - Binder"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&is_video=false&description=浅谈 Android 风控边界 - Binder"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=浅谈 Android 风控边界 - Binder&body=Check out this article: http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&name=浅谈 Android 风控边界 - Binder&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&t=浅谈 Android 风控边界 - Binder"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E9%9A%94%E7%A6%BB%E4%B8%8E%E9%80%9A%E4%BF%A1"><span class="toc-number">1.1.</span> <span class="toc-text">进程隔离与通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%80%81%E5%92%8C%E5%86%85%E6%A0%B8%E6%80%81"><span class="toc-number">1.2.</span> <span class="toc-text">用户态和内核态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Binder-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.</span> <span class="toc-text">Binder 架构设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mmap-%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">mmap 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="toc-number">2.2.</span> <span class="toc-text">内存映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CS-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.3.</span> <span class="toc-text">CS 架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Binder-%E4%BB%A3%E7%A0%81%E6%B5%85%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">Binder 代码浅析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">3.1.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.2.</span> <span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">实际系统调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E5%87%BB"><span class="toc-number">3.3.1.</span> <span class="toc-text">攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E5%AE%88"><span class="toc-number">3.3.2.</span> <span class="toc-text">防守</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E6%80%9D%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">总结思考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        浅谈 Android 风控边界 - Binder
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">bdwms</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-09-09T03:45:33.000Z" class="dt-published" itemprop="datePublished">2023-09-09</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Android/">Android</a>
    </div>


      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <blockquote>
<p>风控的本质是剔除坏人，保留好人。</p>
</blockquote>
<p>在客户端风控对抗中，作为防守方需要在端上采集各种风险因子，环境因素上报服务端进行上报分析用于黑灰产对抗。但是在通过系统 API 进行采集信息时，可能被攻击方进行 Hook 拦截，修改了真实返回值。我们当然可以做 Hook 检测来进行判断，但是攻击方同样也可以反反 Hook，这样子无休止的循环对抗。那么，我们是否可以在关键节点来进行布局对抗呢？下文中，我们将对 Android 系统函数调用流程进行介绍，并阐述在边界处可能的对抗手段。</p>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><h3 id="进程隔离与通信"><a href="#进程隔离与通信" class="headerlink" title="进程隔离与通信"></a>进程隔离与通信</h3><p><img src="https://image.bdwms.com/v2-38e2ea1d22660b237e17d2a7f298f3d6_720w.png" alt="img"></p>
<p>在操作系统中，两个不同进程间内存是不共享的，无法互相访问对方的数据，这就是进程隔离。但是有时候需要进行不同进程间的数据交换，那么就需要特殊的通信机制：进程间通信（IPC） </p>
<p>常见的 IPC 方式有：</p>
<ul>
<li>管道（pipe）：管道描述符是半双工，单向的，数据只能往一个方向流，想要读写需要两个管道描述符。Linux提供了 pipe(fds) 来获取一对描述符，一个读一个写。匿名管道只能用在具有亲缘关系的父子进程间的通信，有名管道无此限制。</li>
<li>Socket：全双工，可读可写。如 Zygote 进程等待AMS系统服务发起 socket 请求来创建应用进程。</li>
<li>共享内存（shm，Shared Memory）：会映射一段能被多个进程访问的内存，是最高效的 IPC 方式，他通常需要结合其他跨进程方式如信号量来同步信息。Android 基于 shm 改进得到匿名共享内存 Ashmem（Anonymous Shared Memory），因高效而适合处理较大的数据，如应用进程通过共享内存来读取 SurfaceFlinger 进程合成的视图数据，进行展示。</li>
<li>内存映射（mmap）：Linux 通过将一个虚拟内存区域与一个磁盘上的文件关联起来，以初始化这个虚拟内存区域的内容。通过指针的方式读写内存，系统会同步进对应的磁盘文件。<strong>Binder用到了 mmap</strong>。</li>
<li>信号（signal）：单向的，发个信号就完事，无返回结果。只能发信号，带不了参数。如子进程被杀掉后系统会发出 SIGCHLD 信号，父进程会清理子进程在进程表的描述信息防止<code>僵尸进程</code>的发生。</li>
<li>外还有文件共享、消息队列（Message）等跨进程通信方式…</li>
</ul>
<h3 id="用户态和内核态"><a href="#用户态和内核态" class="headerlink" title="用户态和内核态"></a>用户态和内核态</h3><p><img src="https://image.bdwms.com/v2-aab2affe42958a659ea8a517ffaff5a0_720w-20230910115914620.png" alt="img"></p>
<p>在操作系统中，有很多高敏感的操作，例如读写文件等，肯定不能直接让用户程序直接调用，所以就需要将核心内核层与应用层隔离，当需要在内核态进行操作时就需要「系统调用」，对于数据拷贝用到的就是以下系统调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">copy_from_user() //将数据从用户空间拷贝到内核空间</span><br><span class="line">copy_to_user() //将数据从内核空间拷贝到用户空间</span><br></pre></td></tr></table></figure>

<h2 id="Binder-架构设计"><a href="#Binder-架构设计" class="headerlink" title="Binder 架构设计"></a>Binder 架构设计</h2><h3 id="mmap-原理"><a href="#mmap-原理" class="headerlink" title="mmap 原理"></a>mmap 原理</h3><p>传统的 read 方式：从硬盘拷贝到内核层，再从内核层拷贝到应用层</p>
<p><img src="https://image.bdwms.com/2052730-20220223095923841-776621370.png" alt="img"></p>
<p>mmap：<strong>在进程的虚拟内存开辟一块空间，映射到内核的物理内存，并建立和文件的关联</strong>，内存映射的实现过程，总的来说可以分为三个阶段：</p>
<p><img src="https://image.bdwms.com/2052730-20220223103718987-1378429682.png" alt="img"></p>
<p><strong>（一）进程启动映射过程，并在虚拟地址空间中为映射创建虚拟映射区域</strong></p>
<ol>
<li>进程在用户空间调用库函数mmap，原型：void *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset);</li>
<li>在当前进程的虚拟地址空间中，寻找一段空闲的满足要求的连续的虚拟地址</li>
<li>为此虚拟区分配一个 vm_area_struct 结构，接着对这个结构的各个域进行了初始化</li>
<li>将新建的虚拟区结构（vm_area_struct）插入进程的虚拟地址区域链表或树中</li>
</ol>
<p><strong>（二）调用内核空间的系统调用函数mmap（不同于用户空间函数），实现文件物理地址和进程虚拟地址的一一映射关系</strong></p>
<ol start="5">
<li>为映射分配了新的虚拟地址区域后，通过待映射的文件指针，在文件描述符表中找到对应的文件描述符，通过文件描述符，链接到内核“已打开文件集”中该文件的文件结构体（struct file），每个文件结构体维护着和这个已打开文件相关各项信息。</li>
<li>通过该文件的文件结构体，链接到file_operations模块，调用内核函数mmap，其原型为：int mmap(struct file *filp, struct vm_area_struct *vma)，不同于用户空间库函数。</li>
<li>内核 mmap 函数通过虚拟文件系统inode模块定位到文件磁盘物理地址。 </li>
<li>通过 remap_pfn_range 函数建立页表，即实现了文件地址和虚拟地址区域的映射关系。此时，这片虚拟地址并没有任何数据关联到主存中。</li>
</ol>
<p><strong>（三）进程发起对这片映射空间的访问，引发缺页异常，实现文件内容到物理内存（主存）的拷贝</strong></p>
<p>注：前两个阶段仅在于创建虚拟区间并完成地址映射，但是并没有将任何文件数据的拷贝至主存。真正的文件读取是当进程发起读或写操作时。</p>
<ol start="9">
<li>进程的读或写操作访问虚拟地址空间这一段映射地址，通过查询页表，发现这一段地址并不在物理页面上。因为目前只建立了地址映射，真正的硬盘数据还没有拷贝到内存中，因此引发缺页异常。</li>
<li>缺页异常进行一系列判断，确定无非法操作后，内核发起请求调页过程。</li>
<li>调页过程先在交换缓存空间（swap cache）中寻找需要访问的内存页，如果没有则调用 nopage 函数把所缺的页从磁盘装入到主存中。</li>
<li>之后进程即可对这片主存进行读或者写的操作，如果写操作改变了其内容，一定时间后系统会自动回写脏页面到对应磁盘地址，也即完成了写入到文件的过程。</li>
</ol>
<p>注：修改过的脏页面并不会立即更新回文件中，而是有一段时间的延迟，可以调用 msync() 来强制同步, 这样所写的内容就能立即保存到文件里了。</p>
<h3 id="内存映射"><a href="#内存映射" class="headerlink" title="内存映射"></a>内存映射</h3><p>Binder 的 IPC 底层机制是通过 mmap 实现：</p>
<blockquote>
<p>内存映射简单的讲就是将用户空间的一块内存区域映射到内核空间。映射关系建立后，用户对这块内存区域的修改可以直接反应到内核空间；反之内核空间对这段区域的修改也能直接反应到用户空间。</p>
</blockquote>
<p>mmap() 通常是用在有物理介质的文件系统上的。比如进程中的用户区域是不能直接和物理设备打交道的，如果想要把磁盘上的数据读取到进程的用户区域，需要两次拷贝（磁盘–&gt;内核空间–&gt;用户空间）；通常在这种场景下 mmap() 就能发挥作用，通过在物理介质和用户空间之间建立映射，减少数据的拷贝次数，用内存读写取代I&#x2F;O读写，提高文件读取效率。</p>
<p>Binder是用来在内核空间创建接受数据的缓存空间：</p>
<ol>
<li>首先 Binder 驱动在内核空间创建一个数据接收缓存区；</li>
<li>接着在内核空间开辟一块内核缓存区，建立<strong>内核缓存区</strong>和<strong>内核中数据接收缓存区</strong>之间的映射关系，以及<strong>内核中数据接收缓存区</strong>和<strong>接收进程用户空间地址</strong>的映射关系；</li>
<li>发送方进程通过系统调用 copy<em>from</em>user() 将数据 copy 到内核中的<strong>内核缓存区</strong>，由于内核缓存区和接收进程的用户空间存在内存映射，因此也就相当于把数据发送到了接收进程的用户空间，这样便完成了一次进程间的通信。</li>
</ol>
<p><img src="https://image.bdwms.com/v2-cbd7d2befbed12d4c8896f236df96dbf_720w.png" alt="img"></p>
<h3 id="CS-架构"><a href="#CS-架构" class="headerlink" title="CS 架构"></a>CS 架构</h3><p>类似微内核的架构，Binder 也是这样的思想：</p>
<p><img src="https://image.bdwms.com/v2-729b3444cd784d882215a24067893d0e_720w.png" alt="img"></p>
<p>类似网络访问的形式</p>
<ul>
<li>Clinet：客户端</li>
<li>Server：服务端</li>
<li>ServiceManager：DNS</li>
<li>Binder Driver：路由器</li>
</ul>
<p><img src="https://image.bdwms.com/v2-67854cdf14d07a6a4acf9d675354e1ff_720w.png" alt="img"></p>
<p>Client 视角中的调用对象其实是 BinderProxy 代理对象，调用方法时就会将参数传递，一路透传到 Binder 驱动进入到内核层，内核层查询 SM 并调用真正的 Sever 进程的 Binder 本地对象，将参数透传给 Server 进程，Server 运行后返回结果又到 Binder 驱动中，再返回给 Client 进程中。</p>
<p><img src="https://image.bdwms.com/v2-13361906ecda16e36a3b9cbe3d38cbc1_720w.png" alt="img"></p>
<h2 id="Binder-代码浅析"><a href="#Binder-代码浅析" class="headerlink" title="Binder 代码浅析"></a>Binder 代码浅析</h2><ul>
<li><strong>IBinder</strong> : IBinder 是一个接口，代表了一种跨进程通信的能力。只要实现了这个借口，这个对象就能跨进程传输。</li>
<li><strong>IInterface</strong> : IInterface 代表的就是 Server 进程对象具备什么样的能力（能提供哪些方法，其实对应的就是 AIDL 文件中定义的接口）</li>
<li><strong>Binder</strong> : Java 层的 Binder 类，代表的其实就是 Binder 本地对象。BinderProxy 类是 Binder 类的一个内部类，它代表远程进程的 Binder 对象的本地代理；这两个类都继承自 IBinder, 因而都具有跨进程传输的能力；实际上，在跨越进程的时候，Binder 驱动会自动完成这两个对象的转换。</li>
<li><strong>Stub</strong> : AIDL 的时候，编译工具会给我们生成一个名为 Stub 的静态内部类；这个类继承了 Binder, 说明它是一个 Binder 本地对象，它实现了 IInterface 接口，表明它具有 Server 承诺给 Client 的能力；Stub 是一个抽象类，具体的 IInterface 的相关实现需要开发者自己实现。</li>
</ul>
<p><img src="https://image.bdwms.com/f65296974043e954ef789174db1c50a0.png" alt="img"></p>
<p>我们可以手写一个 AIDL 跨进程调用，例子参考：<a target="_blank" rel="noopener" href="https://github.com/birdmanwings/HelloBinder">https://github.com/birdmanwings/HelloBinder</a></p>
<p>Java 层最后一个函数 BinderProxy.transact 函数，可以在这个网站上查看 Android 源代码的交叉引用：<a target="_blank" rel="noopener" href="http://aospxref.com/">http://aospxref.com/</a></p>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p><img src="https://image.bdwms.com/image-20230907132054969.png" alt="image-20230907132054969"></p>
<p><img src="https://image.bdwms.com/image-20230907132117336.png" alt="image-20230907132117336"></p>
<p><img src="https://image.bdwms.com/image-20230907132145130.png" alt="image-20230907132145130"></p>
<p>进入调用到 Native 层</p>
<p><img src="https://image.bdwms.com/image-20230907132446172.png" alt="image-20230907132446172"></p>
<p><img src="https://image.bdwms.com/image-20230907132625972.png" alt="image-20230907132625972"></p>
<p><img src="https://image.bdwms.com/image-20230907132854924.png" alt="image-20230907132854924"></p>
<p>ioctl 进入到内核层中的 binder 驱动</p>
<p><img src="https://image.bdwms.com/image-20230907132945227.png" alt="image-20230907132945227"></p>
<h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><p>把 binder 线程注册进入 binder 驱动的线程池中</p>
<p><img src="https://image.bdwms.com/image-20230907133335674.png" alt="image-20230907133335674"></p>
<p>死循环等待指令，来了之后执行命令并向 binder 驱动写回数据</p>
<p><img src="https://image.bdwms.com/image-20230907133539723.png" alt="image-20230907133539723"></p>
<p><img src="https://image.bdwms.com/image-20230907134002638.png" alt="image-20230907134002638"></p>
<p>最后 jni 调用回 java 层 execTransact</p>
<p><img src="https://image.bdwms.com/image-20230907134727041.png" alt="image-20230907134727041"></p>
<p>最后调用回Service 中的 transact</p>
<p><img src="https://image.bdwms.com/image-20230907134845595.png" alt="image-20230907134845595"></p>
<h3 id="实际系统调用"><a href="#实际系统调用" class="headerlink" title="实际系统调用"></a>实际系统调用</h3><p>以及 WiFiManager.getWiFiInfo() 就是通过 Binder 的来调用在系统进程中的 WiFiService，实现了跨 IPC 调用。</p>
<p><img src="https://image.bdwms.com/wifi-arch.png" alt="Wi-Fi 架构"></p>
<p>我们可以看如何在 Java 层直接调用 IPC 通信，获取 Android ID 代码例子如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getAndroidIdByBinder</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// Acquire the ContentProvider</span></span><br><span class="line">        Class&lt;?&gt; activityThreadClass = Class.forName(<span class="string">&quot;android.app.ActivityThread&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">currentActivityThreadMethod</span> <span class="operator">=</span> activityThreadClass.getMethod(<span class="string">&quot;currentActivityThread&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">currentActivityThread</span> <span class="operator">=</span> currentActivityThreadMethod.invoke(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">acquireProviderMethod</span> <span class="operator">=</span> activityThreadClass.getMethod(<span class="string">&quot;acquireProvider&quot;</span>, Context.class, String.class, <span class="type">int</span>.class, <span class="type">boolean</span>.class);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">provider</span> <span class="operator">=</span> acquireProviderMethod.invoke(currentActivityThread, context, <span class="string">&quot;settings&quot;</span>, <span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the Binder</span></span><br><span class="line">        Class&lt;?&gt; iContentProviderClass = Class.forName(<span class="string">&quot;android.content.IContentProvider&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">mRemoteField</span> <span class="operator">=</span> provider.getClass().getDeclaredField(<span class="string">&quot;mRemote&quot;</span>);</span><br><span class="line">        mRemoteField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">IBinder</span> <span class="variable">binder</span> <span class="operator">=</span> (IBinder) mRemoteField.get(provider);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create the Parcel for the arguments</span></span><br><span class="line">        <span class="type">Parcel</span> <span class="variable">data</span> <span class="operator">=</span> Parcel.obtain();</span><br><span class="line">        data.writeInterfaceToken(<span class="string">&quot;android.content.IContentProvider&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT</span><br><span class="line">                &gt;= android.os.Build.VERSION_CODES.S) &#123;</span><br><span class="line">            context.getAttributionSource().writeToParcel(data, <span class="number">0</span>);</span><br><span class="line">            data.writeString(<span class="string">&quot;settings&quot;</span>); <span class="comment">//authority</span></span><br><span class="line">            data.writeString(<span class="string">&quot;GET_secure&quot;</span>); <span class="comment">//method</span></span><br><span class="line">            data.writeString(<span class="string">&quot;android_id&quot;</span>); <span class="comment">//stringArg</span></span><br><span class="line">            data.writeBundle(Bundle.EMPTY);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT</span><br><span class="line">                == android.os.Build.VERSION_CODES.R) &#123;</span><br><span class="line">            <span class="comment">//android 11</span></span><br><span class="line">            data.writeString(context.getPackageName());</span><br><span class="line">            data.writeString(<span class="literal">null</span>); <span class="comment">//featureId</span></span><br><span class="line"></span><br><span class="line">            data.writeString(<span class="string">&quot;settings&quot;</span>); <span class="comment">//authority</span></span><br><span class="line">            data.writeString(<span class="string">&quot;GET_secure&quot;</span>); <span class="comment">//method</span></span><br><span class="line">            data.writeString(<span class="string">&quot;android_id&quot;</span>); <span class="comment">//stringArg</span></span><br><span class="line">            data.writeBundle(Bundle.EMPTY);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT</span><br><span class="line">                == android.os.Build.VERSION_CODES.Q) &#123;</span><br><span class="line">            <span class="comment">//android 10</span></span><br><span class="line">            data.writeString(context.getPackageName());</span><br><span class="line"></span><br><span class="line">            data.writeString(<span class="string">&quot;settings&quot;</span>); <span class="comment">//authority</span></span><br><span class="line">            data.writeString(<span class="string">&quot;GET_secure&quot;</span>); <span class="comment">//method</span></span><br><span class="line">            data.writeString(<span class="string">&quot;android_id&quot;</span>); <span class="comment">//stringArg</span></span><br><span class="line">            data.writeBundle(Bundle.EMPTY);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            data.writeString(context.getPackageName());</span><br><span class="line"></span><br><span class="line">            data.writeString(<span class="string">&quot;GET_secure&quot;</span>); <span class="comment">//method</span></span><br><span class="line">            data.writeString(<span class="string">&quot;android_id&quot;</span>); <span class="comment">//stringArg</span></span><br><span class="line">            data.writeBundle(Bundle.EMPTY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Parcel</span> <span class="variable">reply</span> <span class="operator">=</span> Parcel.obtain();</span><br><span class="line">        binder.transact((<span class="type">int</span>) iContentProviderClass.getDeclaredField(<span class="string">&quot;CALL_TRANSACTION&quot;</span>).get(<span class="literal">null</span>), data, reply, <span class="number">0</span>);</span><br><span class="line">        reply.readException();</span><br><span class="line">        <span class="type">Bundle</span> <span class="variable">bundle</span> <span class="operator">=</span> reply.readBundle();</span><br><span class="line">        reply.recycle();</span><br><span class="line">        data.recycle();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bundle.getString(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h4><p>直接Hook BinderProxy.translate，亦或者更底层的方法，直接在 SystemServer 拦截 execTranslate方法，这个应用测基本无解，但是黑灰产很少修改服务端的逻辑。</p>
<h4 id="防守"><a href="#防守" class="headerlink" title="防守"></a>防守</h4><p>应用进程内最后的 Java 层调用：BinderProxy.transact 代码看 getAndroidIdByBinder 可以来绕过对 Framework 层的修改</p>
<p>自己实现 Native 层的调用 binder 驱动</p>
<p>具体实现需要适配不同的 binder 版本，以及各种可能存在的 Corner Case。</p>
<h2 id="总结思考"><a href="#总结思考" class="headerlink" title="总结思考"></a>总结思考</h2><p>对于风控对抗其实就是原理上的理解，系统代码甚至 BUG 的理解，以及对抗成本与精力对抗，毕竟安全没有银弹！</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="http://aospxref.com/">Android 交叉引用在线查看</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35519585">写给 Android 应用工程师的 Binder 原理剖析</a></li>
<li><a target="_blank" rel="noopener" href="https://weishu.me/2016/01/12/binder-index-for-newer/">Binder学习指南</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/huxiao-tee/p/4660352.html">认真分析mmap：是什么 为什么 怎么用 </a></li>
<li><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-277637.htm">聊聊大厂设备指纹其三&amp;如何在风控对抗这场“猫鼠游戏”中转换角色</a></li>
</ul>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E9%9A%94%E7%A6%BB%E4%B8%8E%E9%80%9A%E4%BF%A1"><span class="toc-number">1.1.</span> <span class="toc-text">进程隔离与通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%80%81%E5%92%8C%E5%86%85%E6%A0%B8%E6%80%81"><span class="toc-number">1.2.</span> <span class="toc-text">用户态和内核态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Binder-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.</span> <span class="toc-text">Binder 架构设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mmap-%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">mmap 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="toc-number">2.2.</span> <span class="toc-text">内存映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CS-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.3.</span> <span class="toc-text">CS 架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Binder-%E4%BB%A3%E7%A0%81%E6%B5%85%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">Binder 代码浅析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">3.1.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.2.</span> <span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">实际系统调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E5%87%BB"><span class="toc-number">3.3.1.</span> <span class="toc-text">攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E5%AE%88"><span class="toc-number">3.3.2.</span> <span class="toc-text">防守</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E6%80%9D%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">总结思考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&text=浅谈 Android 风控边界 - Binder"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&is_video=false&description=浅谈 Android 风控边界 - Binder"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=浅谈 Android 风控边界 - Binder&body=Check out this article: http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&title=浅谈 Android 风控边界 - Binder"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&name=浅谈 Android 风控边界 - Binder&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/a-brief-discussion-on-android-risk-control-boundaries-binder/&t=浅谈 Android 风控边界 - Binder"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2018-2023
    <a target="_blank" rel="noopener" href="https://bdwms.site">bdwms<a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
          <li><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">皖ICP备18025933号-3</a></li>
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->


 
  <link
    rel="preload"
    href="/lib/font-awesome/css/all.min.css"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript
    ><link
      rel="stylesheet"
      href="/lib/font-awesome/css/all.min.css"
  /></noscript>


    <!-- jquery -->

  
<script src="/lib/jquery/jquery.min.js"></script>





<!-- clipboard -->

  
    
<script src="/lib/clipboard/clipboard.min.js"></script>

  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'birdmanwings/birdmanwings.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
